{% load static %}
<!DOCTYPE html>

<html>
    <head>
        <title>{% block title %}{% endblock %}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, post-check=0, pre-check=0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
        
        

    </head>
    <body>
      <div id="root">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid" style="padding: 10px">
              <a class="navbar-brand" href="{% url 'maintenance_plan:line' %}"style="margin-left:10px ;font-size: 15px; font-weight: bold; color: #cc302b;">GMAO <span style = "margin-bottom: 0px;display:block;"></span> Bracour</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor04" aria-controls="navbarColor04" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarColor04">
                <ul class="navbar-nav me-auto">
                  <li class="nav-item">
                    <a class="nav-link active" href="#">Dashboard
                      <span class="visually-hidden">(current)</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'maintenance_plan:task' %}">Tasks</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Pricing</a>
                  </li>
                  
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" type="button" aria-haspopup="true" aria-expanded="false">Dropdown</a>
                    <div class="dropdown-menu">
                      <a class="dropdown-item" href="#">Action</a>
                      <a class="dropdown-item" href="#">Another action</a>
                      <a class="dropdown-item" href="#">Something else here</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="#">Separated link</a>
                    </div>
                  </li>
                </ul>
                {% if request.user.is_authenticated %}
                  <div class="container nav-item p-2">
                    <div class="row justify-content-md-center ">
                      <div class="col col-lg-11 text-end ">
                        <p class="fs-3 ">Welcome {{ user.username }}!</p>
                      </div>
                      <div class="col col-log-2">
                        <form class="d-flex" method="post" action="{% url 'account:logout' %}">
                          {% csrf_token %}
                          <button class="btn btn-outline-danger" type="submit">Logout</button>
                        </form>
                        <i class="bi bi-person-check-fill"></i>
                    </div>
                    </div>
                  </div>
                {% else %}
                  <a href="{% url 'account:signup' %}" class="btn btn-primary btn-lg">Sign up</a>
                  <a href="{% url 'account:login' %}" class="btn btn-secondary btn-lg">Log in</a>                
                {% endif %}
              </div>
            </div>
        </nav>

        <div class="px-6 py-6 ">
          {% block content %}
          {% endblock %}
        </div>
        <footer class="bg-light">
          <div class="m-6 p-6">
            <p class="fs-4 text-danger">Coca-Cola Bottling Company in Haiti </p>
          </div>
          
        </footer>
      
        
        </div>

        <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

        <script>
          class LoginPage extends React.Component {
            constructor(props) {
              super(props);
              this.state = {
                loggedIn: false,
              };
            }

            componentDidMount() {
              if (localStorage.getItem('userToken')) {
                this.setState({ loggedIn: true });
              }

              window.addEventListener('beforeunload', this.handleBeforeUnload);
            }

            componentWillUnmount() {
              window.removeEventListener('beforeunload', this.handleBeforeUnload);
            }

            handleBeforeUnload = () => {
              localStorage.removeItem('userToken');
            };

            handleSubmit = (event) => {
              event.preventDefault();
              // Code pour traiter les données de formulaire et effectuer la connexion
              // ...
              // Une fois la connexion réussie, on stocke le token de connexion en local storage
              localStorage.setItem('userToken', 'valeur_du_token');
              this.setState({ loggedIn: true });
            };

            handleLogout = () => {
              localStorage.removeItem('userToken');
              this.setState({ loggedIn: false });
            };

            render() {
              return (
                <div>
                  {!this.state.loggedIn && (
                    <form onSubmit={this.handleSubmit}>
                      <label htmlFor="username">Nom d'utilisateur</label>
                      <input type="text" id="username" name="username" required />

                      <label htmlFor="password">Mot de passe</label>
                      <input type="password" id="password" name="password" required />
                      <button type="submit">Connexion</button>
                    </form>
                  )}
                  {this.state.loggedIn && (
                    <div>
                      <p>Vous êtes connecté !</p>
                      <button onClick={this.handleLogout}>Déconnexion</button>
                    </div>
                  )}
                </div>
              );
            }
          }

          ReactDOM.render(<LoginPage />, document.getElementById('root'));
        </script>
                
        
        
    </body>
</html>
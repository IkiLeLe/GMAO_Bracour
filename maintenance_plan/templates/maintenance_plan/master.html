{% load static %}
<!DOCTYPE html>

<html>
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>{% block title %}{% endblock %}</title>
      <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, post-check=0, pre-check=0">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  
    </head>
    <body>
      <div id="root">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid" style="padding: 10px">
              <a class="navbar-brand" href="{% url 'maintenance_plan:line' %}"style="margin-left:10px ;font-size: 15px; font-weight: bold; color: #cc302b;">GMAO <span style = "margin-bottom: 0px;display:block;"></span> Bracour</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor04" aria-controls="navbarColor04" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              {% if request.user.is_authenticated %}
              <div class="collapse navbar-collapse" id="navbarColor04">
                <ul class="navbar-nav me-auto">
                  <li class="nav-item">
                    <a class="nav-link active" href="#">Dashboard
                      <span class="visually-hidden">(current)</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'maintenance_plan:task' %}">Tasks</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Pricing</a>
                  </li>
                  
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" type="button" aria-haspopup="true" aria-expanded="false">Dropdown</a>
                    <div class="dropdown-menu">
                      <a class="dropdown-item" href="#">Action</a>
                      <a class="dropdown-item" href="#">Another action</a>
                      <a class="dropdown-item" href="#">Something else here</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="#">Separated link</a>
                    </div>
                  </li>
                </ul>
                
                  <div class="container nav-item p-2 text-end">
                    <div class="row justify-content-end">
                      <div class="col-4">
                        <p class="fs-3 ">Welcome {{ user.username }}!</p>
                      </div>
                      <div class="col-1">
                        <form class="d-flex" method="post" action="{% url 'account:logout' %}">
                          {% csrf_token %}
                          <button class="btn btn-outline-danger" type="submit" id="logoutButton" onClick="handleLogout">Logout</button>
                        </form>
                      </div>
                    </div>
                  </div>
                {% else %}
                 <div class="container nav-item p-2 text-end">
                    <div class="row justify-content-end">
                      <div class="col-2 ">
                       <a href="{% url 'account:signup' %}" class="btn btn-primary btn-lg">Sign up</a>
                      </div>
                      <div class="col-2">
                        <a href="{% url 'account:login' %}" class="btn btn-secondary btn-lg">Log in</a>
                      </div>
                   </div>
                  </div>      
                {% endif %}
              </div>
            </div>
        </nav>

        <div class="px-6 py-6 ">
          {% block content %}
          {% endblock %}
        </div>
        <footer class="bg-light text-center">
          <div class="m-6 p-6">
            <p class="fs-4 text-danger">Brasserie de La Couronne, Coca-Cola Bottling Company in Haiti </p>
          </div>
          
        </footer>
      
        
      </div>
      
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const loggedIn = JSON.parse("{{ request.user.is_authenticated|yesno:'true,false'|lower }}".toLowerCase()); // Check authentication status from session

          const handleSubmit = (event) => {
              event.preventDefault();
              // Code to handle form data and perform login
              // ...
              // Upon successful login, the user token will be stored in the session by your Django view
              window.location.reload(); // Reload the page to reflect the logged-in state
          };

          const handleLogout = () => {
              // The token will be removed from the session by your Django view
              window.location.href = '/login'; // Redirect to login page
          };

          // ... (rest of your code remains the same)
          // Gestionnaire d'événement pour le formulaire de connexion
          const loginForm = document.querySelector('#loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleSubmit);
            }

            // Gestionnaire d'événement pour le bouton de déconnexion
          const logoutButton = document.querySelector('#logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', handleLogout);
            }
            
          document.addEventListener('backbutton', function () {
                // Vérifie si l'utilisateur est déconnecté
                if (!loggedIn) {
                    window.location.href = '/login';
                }
            });

            // Ajoute un gestionnaire d'événement avant le déchargement de la page
            window.addEventListener('beforeunload', handleBeforeUnload);


          // Access the user token from the session if needed
          if (loggedIn) {
            const token = JSON.parse("{{ request.session.userToken|default:'{}' }}"); // Get the token from the session
              // Use the token for other purposes if needed
          }
      });

    </script>
  

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous" defer></script>

        
    </body>
</html>

<!--

  document.addEventListener("DOMContentLoaded", function () {
            const loggedIn = localStorage.getItem('userToken') !== null;

            const handleBeforeUnload = () => {
                localStorage.removeItem('userToken');
            };

            const handleSubmit = (event) => {
                event.preventDefault();
                // Code pour traiter les données de formulaire et effectuer la connexion
                // ...
                // Une fois la connexion réussie, on stocke le token de connexion en local storage
                localStorage.setItem('userToken', 'valeur_du_token');
                window.location.reload(); // Recharge la page pour refléter l'état connecté
            };

            const handleLogout = () => {
                localStorage.removeItem('userToken');
                window.location.href = '/login'; // Redirige vers la page de connexion
            };

            // Gestionnaire d'événement pour le formulaire de connexion
            const loginForm = document.querySelector('#loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleSubmit);
            }

            // Gestionnaire d'événement pour le bouton de déconnexion
            const logoutButton = document.querySelector('#logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', handleLogout);
            }

            document.addEventListener('backbutton', function () {
              // Vérifie si l'utilisateur est déconnecté
              const loggedIn = localStorage.getItem('userToken') !== null;

              // Si l'utilisateur est déconnecté, redirige vers la page de connexion
              if (!loggedIn) {
                window.location.href = '/login';
              }
            });

            // Ajoute un gestionnaire d'événement avant le déchargement de la page
            window.addEventListener('beforeunload', handleBeforeUnload);

            // Met à jour l'état connecté lors du chargement de la page
            if (loggedIn) {
                const loggedInMessage = document.createElement('p');
                loggedInMessage.textContent = 'Vous êtes connecté !';
                document.body.appendChild(loggedInMessage);

                const logoutButton = document.createElement('button');
                logoutButton.textContent = 'Déconnexion';
                logoutButton.addEventListener('click', handleLogout);
                document.body.appendChild(logoutButton);
            }
        });
-->